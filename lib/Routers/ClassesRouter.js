"use strict";

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.default = exports.ClassesRouter = void 0;
var _PromiseRouter = _interopRequireDefault(require("../PromiseRouter"));
var _rest = _interopRequireDefault(require("../rest"));
var _lodash = _interopRequireDefault(require("lodash"));
var _node = _interopRequireDefault(require("parse/node"));
var _middlewares = require("../middlewares");
function _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }
const ALLOWED_GET_QUERY_KEYS = ['keys', 'include', 'excludeKeys', 'readPreference', 'includeReadPreference', 'subqueryReadPreference'];
class ClassesRouter extends _PromiseRouter.default {
  className(req) {
    return req.params.className;
  }
  handleFind(req) {
    const body = Object.assign(req.body, ClassesRouter.JSONFromQuery(req.query));
    const options = ClassesRouter.optionsFromBody(body);
    if (req.config.maxLimit && body.limit > req.config.maxLimit) {
      // Silently replace the limit on the query with the max configured
      options.limit = Number(req.config.maxLimit);
    }
    if (body.redirectClassNameForKey) {
      options.redirectClassNameForKey = String(body.redirectClassNameForKey);
    }
    if (typeof body.where === 'string') {
      body.where = JSON.parse(body.where);
    }
    return _rest.default.find(req.config, req.auth, this.className(req), body.where, options, req.info.clientSDK, req.info.context).then(response => {
      return {
        response: response
      };
    });
  }

  // Returns a promise for a {response} object.
  handleGet(req) {
    const body = Object.assign(req.body, ClassesRouter.JSONFromQuery(req.query));
    const options = {};
    for (const key of Object.keys(body)) {
      if (ALLOWED_GET_QUERY_KEYS.indexOf(key) === -1) {
        throw new _node.default.Error(_node.default.Error.INVALID_QUERY, 'Improper encode of parameter');
      }
    }
    if (body.keys != null) {
      options.keys = String(body.keys);
    }
    if (body.include != null) {
      options.include = String(body.include);
    }
    if (body.excludeKeys != null) {
      options.excludeKeys = String(body.excludeKeys);
    }
    if (typeof body.readPreference === 'string') {
      options.readPreference = body.readPreference;
    }
    if (typeof body.includeReadPreference === 'string') {
      options.includeReadPreference = body.includeReadPreference;
    }
    if (typeof body.subqueryReadPreference === 'string') {
      options.subqueryReadPreference = body.subqueryReadPreference;
    }
    return _rest.default.get(req.config, req.auth, this.className(req), req.params.objectId, options, req.info.clientSDK, req.info.context).then(response => {
      if (!response.results || response.results.length == 0) {
        throw new _node.default.Error(_node.default.Error.OBJECT_NOT_FOUND, 'Object not found.');
      }
      if (this.className(req) === '_User') {
        delete response.results[0].sessionToken;
        const user = response.results[0];
        if (req.auth.user && user.objectId == req.auth.user.id) {
          // Force the session token
          response.results[0].sessionToken = req.info.sessionToken;
        }
      }
      return {
        response: response.results[0]
      };
    });
  }
  handleCreate(req) {
    return _rest.default.create(req.config, req.auth, this.className(req), req.body, req.info.clientSDK, req.info.context);
  }
  handleUpdate(req) {
    const where = {
      objectId: req.params.objectId
    };
    return _rest.default.update(req.config, req.auth, this.className(req), where, req.body, req.info.clientSDK, req.info.context);
  }
  handleDelete(req) {
    return _rest.default.del(req.config, req.auth, this.className(req), req.params.objectId, req.info.context).then(() => {
      return {
        response: {}
      };
    });
  }
  static JSONFromQuery(query) {
    const json = {};
    for (const [key, value] of _lodash.default.entries(query)) {
      try {
        json[key] = JSON.parse(value);
      } catch (e) {
        json[key] = value;
      }
    }
    return json;
  }
  static optionsFromBody(body) {
    const allowConstraints = ['skip', 'limit', 'order', 'count', 'keys', 'excludeKeys', 'include', 'includeAll', 'redirectClassNameForKey', 'where', 'readPreference', 'includeReadPreference', 'subqueryReadPreference', 'hint', 'explain'];
    for (const key of Object.keys(body)) {
      if (allowConstraints.indexOf(key) === -1) {
        throw new _node.default.Error(_node.default.Error.INVALID_QUERY, `Invalid parameter for query: ${key}`);
      }
    }
    const options = {};
    if (body.skip) {
      options.skip = Number(body.skip);
    }
    if (body.limit || body.limit === 0) {
      options.limit = Number(body.limit);
    } else {
      options.limit = Number(100);
    }
    if (body.order) {
      options.order = String(body.order);
    }
    if (body.count) {
      options.count = true;
    }
    if (body.keys != null) {
      options.keys = String(body.keys);
    }
    if (body.excludeKeys != null) {
      options.excludeKeys = String(body.excludeKeys);
    }
    if (body.include != null) {
      options.include = String(body.include);
    }
    if (body.includeAll) {
      options.includeAll = true;
    }
    if (typeof body.readPreference === 'string') {
      options.readPreference = body.readPreference;
    }
    if (typeof body.includeReadPreference === 'string') {
      options.includeReadPreference = body.includeReadPreference;
    }
    if (typeof body.subqueryReadPreference === 'string') {
      options.subqueryReadPreference = body.subqueryReadPreference;
    }
    if (body.hint && (typeof body.hint === 'string' || typeof body.hint === 'object')) {
      options.hint = body.hint;
    }
    if (body.explain) {
      options.explain = body.explain;
    }
    return options;
  }
  mountRoutes() {
    this.route('GET', '/classes/:className', req => {
      return this.handleFind(req);
    });
    this.route('GET', '/classes/:className/:objectId', req => {
      return this.handleGet(req);
    });
    this.route('POST', '/classes/:className', _middlewares.promiseEnsureIdempotency, req => {
      return this.handleCreate(req);
    });
    this.route('PUT', '/classes/:className/:objectId', _middlewares.promiseEnsureIdempotency, req => {
      return this.handleUpdate(req);
    });
    this.route('DELETE', '/classes/:className/:objectId', req => {
      return this.handleDelete(req);
    });
  }
}
exports.ClassesRouter = ClassesRouter;
var _default = ClassesRouter;
exports.default = _default;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJuYW1lcyI6WyJfUHJvbWlzZVJvdXRlciIsIl9pbnRlcm9wUmVxdWlyZURlZmF1bHQiLCJyZXF1aXJlIiwiX3Jlc3QiLCJfbG9kYXNoIiwiX25vZGUiLCJfbWlkZGxld2FyZXMiLCJvYmoiLCJfX2VzTW9kdWxlIiwiZGVmYXVsdCIsIkFMTE9XRURfR0VUX1FVRVJZX0tFWVMiLCJDbGFzc2VzUm91dGVyIiwiUHJvbWlzZVJvdXRlciIsImNsYXNzTmFtZSIsInJlcSIsInBhcmFtcyIsImhhbmRsZUZpbmQiLCJib2R5IiwiT2JqZWN0IiwiYXNzaWduIiwiSlNPTkZyb21RdWVyeSIsInF1ZXJ5Iiwib3B0aW9ucyIsIm9wdGlvbnNGcm9tQm9keSIsImNvbmZpZyIsIm1heExpbWl0IiwibGltaXQiLCJOdW1iZXIiLCJyZWRpcmVjdENsYXNzTmFtZUZvcktleSIsIlN0cmluZyIsIndoZXJlIiwiSlNPTiIsInBhcnNlIiwicmVzdCIsImZpbmQiLCJhdXRoIiwiaW5mbyIsImNsaWVudFNESyIsImNvbnRleHQiLCJ0aGVuIiwicmVzcG9uc2UiLCJoYW5kbGVHZXQiLCJrZXkiLCJrZXlzIiwiaW5kZXhPZiIsIlBhcnNlIiwiRXJyb3IiLCJJTlZBTElEX1FVRVJZIiwiaW5jbHVkZSIsImV4Y2x1ZGVLZXlzIiwicmVhZFByZWZlcmVuY2UiLCJpbmNsdWRlUmVhZFByZWZlcmVuY2UiLCJzdWJxdWVyeVJlYWRQcmVmZXJlbmNlIiwiZ2V0Iiwib2JqZWN0SWQiLCJyZXN1bHRzIiwibGVuZ3RoIiwiT0JKRUNUX05PVF9GT1VORCIsInNlc3Npb25Ub2tlbiIsInVzZXIiLCJpZCIsImhhbmRsZUNyZWF0ZSIsImNyZWF0ZSIsImhhbmRsZVVwZGF0ZSIsInVwZGF0ZSIsImhhbmRsZURlbGV0ZSIsImRlbCIsImpzb24iLCJ2YWx1ZSIsIl8iLCJlbnRyaWVzIiwiZSIsImFsbG93Q29uc3RyYWludHMiLCJza2lwIiwib3JkZXIiLCJjb3VudCIsImluY2x1ZGVBbGwiLCJoaW50IiwiZXhwbGFpbiIsIm1vdW50Um91dGVzIiwicm91dGUiLCJwcm9taXNlRW5zdXJlSWRlbXBvdGVuY3kiLCJleHBvcnRzIiwiX2RlZmF1bHQiXSwic291cmNlcyI6WyIuLi8uLi9zcmMvUm91dGVycy9DbGFzc2VzUm91dGVyLmpzIl0sInNvdXJjZXNDb250ZW50IjpbImltcG9ydCBQcm9taXNlUm91dGVyIGZyb20gJy4uL1Byb21pc2VSb3V0ZXInO1xuaW1wb3J0IHJlc3QgZnJvbSAnLi4vcmVzdCc7XG5pbXBvcnQgXyBmcm9tICdsb2Rhc2gnO1xuaW1wb3J0IFBhcnNlIGZyb20gJ3BhcnNlL25vZGUnO1xuaW1wb3J0IHsgcHJvbWlzZUVuc3VyZUlkZW1wb3RlbmN5IH0gZnJvbSAnLi4vbWlkZGxld2FyZXMnO1xuXG5jb25zdCBBTExPV0VEX0dFVF9RVUVSWV9LRVlTID0gW1xuICAna2V5cycsXG4gICdpbmNsdWRlJyxcbiAgJ2V4Y2x1ZGVLZXlzJyxcbiAgJ3JlYWRQcmVmZXJlbmNlJyxcbiAgJ2luY2x1ZGVSZWFkUHJlZmVyZW5jZScsXG4gICdzdWJxdWVyeVJlYWRQcmVmZXJlbmNlJyxcbl07XG5cbmV4cG9ydCBjbGFzcyBDbGFzc2VzUm91dGVyIGV4dGVuZHMgUHJvbWlzZVJvdXRlciB7XG4gIGNsYXNzTmFtZShyZXEpIHtcbiAgICByZXR1cm4gcmVxLnBhcmFtcy5jbGFzc05hbWU7XG4gIH1cblxuICBoYW5kbGVGaW5kKHJlcSkge1xuICAgIGNvbnN0IGJvZHkgPSBPYmplY3QuYXNzaWduKHJlcS5ib2R5LCBDbGFzc2VzUm91dGVyLkpTT05Gcm9tUXVlcnkocmVxLnF1ZXJ5KSk7XG4gICAgY29uc3Qgb3B0aW9ucyA9IENsYXNzZXNSb3V0ZXIub3B0aW9uc0Zyb21Cb2R5KGJvZHkpO1xuICAgIGlmIChyZXEuY29uZmlnLm1heExpbWl0ICYmIGJvZHkubGltaXQgPiByZXEuY29uZmlnLm1heExpbWl0KSB7XG4gICAgICAvLyBTaWxlbnRseSByZXBsYWNlIHRoZSBsaW1pdCBvbiB0aGUgcXVlcnkgd2l0aCB0aGUgbWF4IGNvbmZpZ3VyZWRcbiAgICAgIG9wdGlvbnMubGltaXQgPSBOdW1iZXIocmVxLmNvbmZpZy5tYXhMaW1pdCk7XG4gICAgfVxuICAgIGlmIChib2R5LnJlZGlyZWN0Q2xhc3NOYW1lRm9yS2V5KSB7XG4gICAgICBvcHRpb25zLnJlZGlyZWN0Q2xhc3NOYW1lRm9yS2V5ID0gU3RyaW5nKGJvZHkucmVkaXJlY3RDbGFzc05hbWVGb3JLZXkpO1xuICAgIH1cbiAgICBpZiAodHlwZW9mIGJvZHkud2hlcmUgPT09ICdzdHJpbmcnKSB7XG4gICAgICBib2R5LndoZXJlID0gSlNPTi5wYXJzZShib2R5LndoZXJlKTtcbiAgICB9XG4gICAgcmV0dXJuIHJlc3RcbiAgICAgIC5maW5kKFxuICAgICAgICByZXEuY29uZmlnLFxuICAgICAgICByZXEuYXV0aCxcbiAgICAgICAgdGhpcy5jbGFzc05hbWUocmVxKSxcbiAgICAgICAgYm9keS53aGVyZSxcbiAgICAgICAgb3B0aW9ucyxcbiAgICAgICAgcmVxLmluZm8uY2xpZW50U0RLLFxuICAgICAgICByZXEuaW5mby5jb250ZXh0XG4gICAgICApXG4gICAgICAudGhlbihyZXNwb25zZSA9PiB7XG4gICAgICAgIHJldHVybiB7IHJlc3BvbnNlOiByZXNwb25zZSB9O1xuICAgICAgfSk7XG4gIH1cblxuICAvLyBSZXR1cm5zIGEgcHJvbWlzZSBmb3IgYSB7cmVzcG9uc2V9IG9iamVjdC5cbiAgaGFuZGxlR2V0KHJlcSkge1xuICAgIGNvbnN0IGJvZHkgPSBPYmplY3QuYXNzaWduKHJlcS5ib2R5LCBDbGFzc2VzUm91dGVyLkpTT05Gcm9tUXVlcnkocmVxLnF1ZXJ5KSk7XG4gICAgY29uc3Qgb3B0aW9ucyA9IHt9O1xuXG4gICAgZm9yIChjb25zdCBrZXkgb2YgT2JqZWN0LmtleXMoYm9keSkpIHtcbiAgICAgIGlmIChBTExPV0VEX0dFVF9RVUVSWV9LRVlTLmluZGV4T2Yoa2V5KSA9PT0gLTEpIHtcbiAgICAgICAgdGhyb3cgbmV3IFBhcnNlLkVycm9yKFBhcnNlLkVycm9yLklOVkFMSURfUVVFUlksICdJbXByb3BlciBlbmNvZGUgb2YgcGFyYW1ldGVyJyk7XG4gICAgICB9XG4gICAgfVxuXG4gICAgaWYgKGJvZHkua2V5cyAhPSBudWxsKSB7XG4gICAgICBvcHRpb25zLmtleXMgPSBTdHJpbmcoYm9keS5rZXlzKTtcbiAgICB9XG4gICAgaWYgKGJvZHkuaW5jbHVkZSAhPSBudWxsKSB7XG4gICAgICBvcHRpb25zLmluY2x1ZGUgPSBTdHJpbmcoYm9keS5pbmNsdWRlKTtcbiAgICB9XG4gICAgaWYgKGJvZHkuZXhjbHVkZUtleXMgIT0gbnVsbCkge1xuICAgICAgb3B0aW9ucy5leGNsdWRlS2V5cyA9IFN0cmluZyhib2R5LmV4Y2x1ZGVLZXlzKTtcbiAgICB9XG4gICAgaWYgKHR5cGVvZiBib2R5LnJlYWRQcmVmZXJlbmNlID09PSAnc3RyaW5nJykge1xuICAgICAgb3B0aW9ucy5yZWFkUHJlZmVyZW5jZSA9IGJvZHkucmVhZFByZWZlcmVuY2U7XG4gICAgfVxuICAgIGlmICh0eXBlb2YgYm9keS5pbmNsdWRlUmVhZFByZWZlcmVuY2UgPT09ICdzdHJpbmcnKSB7XG4gICAgICBvcHRpb25zLmluY2x1ZGVSZWFkUHJlZmVyZW5jZSA9IGJvZHkuaW5jbHVkZVJlYWRQcmVmZXJlbmNlO1xuICAgIH1cbiAgICBpZiAodHlwZW9mIGJvZHkuc3VicXVlcnlSZWFkUHJlZmVyZW5jZSA9PT0gJ3N0cmluZycpIHtcbiAgICAgIG9wdGlvbnMuc3VicXVlcnlSZWFkUHJlZmVyZW5jZSA9IGJvZHkuc3VicXVlcnlSZWFkUHJlZmVyZW5jZTtcbiAgICB9XG5cbiAgICByZXR1cm4gcmVzdFxuICAgICAgLmdldChcbiAgICAgICAgcmVxLmNvbmZpZyxcbiAgICAgICAgcmVxLmF1dGgsXG4gICAgICAgIHRoaXMuY2xhc3NOYW1lKHJlcSksXG4gICAgICAgIHJlcS5wYXJhbXMub2JqZWN0SWQsXG4gICAgICAgIG9wdGlvbnMsXG4gICAgICAgIHJlcS5pbmZvLmNsaWVudFNESyxcbiAgICAgICAgcmVxLmluZm8uY29udGV4dFxuICAgICAgKVxuICAgICAgLnRoZW4ocmVzcG9uc2UgPT4ge1xuICAgICAgICBpZiAoIXJlc3BvbnNlLnJlc3VsdHMgfHwgcmVzcG9uc2UucmVzdWx0cy5sZW5ndGggPT0gMCkge1xuICAgICAgICAgIHRocm93IG5ldyBQYXJzZS5FcnJvcihQYXJzZS5FcnJvci5PQkpFQ1RfTk9UX0ZPVU5ELCAnT2JqZWN0IG5vdCBmb3VuZC4nKTtcbiAgICAgICAgfVxuXG4gICAgICAgIGlmICh0aGlzLmNsYXNzTmFtZShyZXEpID09PSAnX1VzZXInKSB7XG4gICAgICAgICAgZGVsZXRlIHJlc3BvbnNlLnJlc3VsdHNbMF0uc2Vzc2lvblRva2VuO1xuXG4gICAgICAgICAgY29uc3QgdXNlciA9IHJlc3BvbnNlLnJlc3VsdHNbMF07XG5cbiAgICAgICAgICBpZiAocmVxLmF1dGgudXNlciAmJiB1c2VyLm9iamVjdElkID09IHJlcS5hdXRoLnVzZXIuaWQpIHtcbiAgICAgICAgICAgIC8vIEZvcmNlIHRoZSBzZXNzaW9uIHRva2VuXG4gICAgICAgICAgICByZXNwb25zZS5yZXN1bHRzWzBdLnNlc3Npb25Ub2tlbiA9IHJlcS5pbmZvLnNlc3Npb25Ub2tlbjtcbiAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIHsgcmVzcG9uc2U6IHJlc3BvbnNlLnJlc3VsdHNbMF0gfTtcbiAgICAgIH0pO1xuICB9XG5cbiAgaGFuZGxlQ3JlYXRlKHJlcSkge1xuICAgIHJldHVybiByZXN0LmNyZWF0ZShcbiAgICAgIHJlcS5jb25maWcsXG4gICAgICByZXEuYXV0aCxcbiAgICAgIHRoaXMuY2xhc3NOYW1lKHJlcSksXG4gICAgICByZXEuYm9keSxcbiAgICAgIHJlcS5pbmZvLmNsaWVudFNESyxcbiAgICAgIHJlcS5pbmZvLmNvbnRleHRcbiAgICApO1xuICB9XG5cbiAgaGFuZGxlVXBkYXRlKHJlcSkge1xuICAgIGNvbnN0IHdoZXJlID0geyBvYmplY3RJZDogcmVxLnBhcmFtcy5vYmplY3RJZCB9O1xuICAgIHJldHVybiByZXN0LnVwZGF0ZShcbiAgICAgIHJlcS5jb25maWcsXG4gICAgICByZXEuYXV0aCxcbiAgICAgIHRoaXMuY2xhc3NOYW1lKHJlcSksXG4gICAgICB3aGVyZSxcbiAgICAgIHJlcS5ib2R5LFxuICAgICAgcmVxLmluZm8uY2xpZW50U0RLLFxuICAgICAgcmVxLmluZm8uY29udGV4dFxuICAgICk7XG4gIH1cblxuICBoYW5kbGVEZWxldGUocmVxKSB7XG4gICAgcmV0dXJuIHJlc3RcbiAgICAgIC5kZWwocmVxLmNvbmZpZywgcmVxLmF1dGgsIHRoaXMuY2xhc3NOYW1lKHJlcSksIHJlcS5wYXJhbXMub2JqZWN0SWQsIHJlcS5pbmZvLmNvbnRleHQpXG4gICAgICAudGhlbigoKSA9PiB7XG4gICAgICAgIHJldHVybiB7IHJlc3BvbnNlOiB7fSB9O1xuICAgICAgfSk7XG4gIH1cblxuICBzdGF0aWMgSlNPTkZyb21RdWVyeShxdWVyeSkge1xuICAgIGNvbnN0IGpzb24gPSB7fTtcbiAgICBmb3IgKGNvbnN0IFtrZXksIHZhbHVlXSBvZiBfLmVudHJpZXMocXVlcnkpKSB7XG4gICAgICB0cnkge1xuICAgICAgICBqc29uW2tleV0gPSBKU09OLnBhcnNlKHZhbHVlKTtcbiAgICAgIH0gY2F0Y2ggKGUpIHtcbiAgICAgICAganNvbltrZXldID0gdmFsdWU7XG4gICAgICB9XG4gICAgfVxuICAgIHJldHVybiBqc29uO1xuICB9XG5cbiAgc3RhdGljIG9wdGlvbnNGcm9tQm9keShib2R5KSB7XG4gICAgY29uc3QgYWxsb3dDb25zdHJhaW50cyA9IFtcbiAgICAgICdza2lwJyxcbiAgICAgICdsaW1pdCcsXG4gICAgICAnb3JkZXInLFxuICAgICAgJ2NvdW50JyxcbiAgICAgICdrZXlzJyxcbiAgICAgICdleGNsdWRlS2V5cycsXG4gICAgICAnaW5jbHVkZScsXG4gICAgICAnaW5jbHVkZUFsbCcsXG4gICAgICAncmVkaXJlY3RDbGFzc05hbWVGb3JLZXknLFxuICAgICAgJ3doZXJlJyxcbiAgICAgICdyZWFkUHJlZmVyZW5jZScsXG4gICAgICAnaW5jbHVkZVJlYWRQcmVmZXJlbmNlJyxcbiAgICAgICdzdWJxdWVyeVJlYWRQcmVmZXJlbmNlJyxcbiAgICAgICdoaW50JyxcbiAgICAgICdleHBsYWluJyxcbiAgICBdO1xuXG4gICAgZm9yIChjb25zdCBrZXkgb2YgT2JqZWN0LmtleXMoYm9keSkpIHtcbiAgICAgIGlmIChhbGxvd0NvbnN0cmFpbnRzLmluZGV4T2Yoa2V5KSA9PT0gLTEpIHtcbiAgICAgICAgdGhyb3cgbmV3IFBhcnNlLkVycm9yKFBhcnNlLkVycm9yLklOVkFMSURfUVVFUlksIGBJbnZhbGlkIHBhcmFtZXRlciBmb3IgcXVlcnk6ICR7a2V5fWApO1xuICAgICAgfVxuICAgIH1cbiAgICBjb25zdCBvcHRpb25zID0ge307XG4gICAgaWYgKGJvZHkuc2tpcCkge1xuICAgICAgb3B0aW9ucy5za2lwID0gTnVtYmVyKGJvZHkuc2tpcCk7XG4gICAgfVxuICAgIGlmIChib2R5LmxpbWl0IHx8IGJvZHkubGltaXQgPT09IDApIHtcbiAgICAgIG9wdGlvbnMubGltaXQgPSBOdW1iZXIoYm9keS5saW1pdCk7XG4gICAgfSBlbHNlIHtcbiAgICAgIG9wdGlvbnMubGltaXQgPSBOdW1iZXIoMTAwKTtcbiAgICB9XG4gICAgaWYgKGJvZHkub3JkZXIpIHtcbiAgICAgIG9wdGlvbnMub3JkZXIgPSBTdHJpbmcoYm9keS5vcmRlcik7XG4gICAgfVxuICAgIGlmIChib2R5LmNvdW50KSB7XG4gICAgICBvcHRpb25zLmNvdW50ID0gdHJ1ZTtcbiAgICB9XG4gICAgaWYgKGJvZHkua2V5cyAhPSBudWxsKSB7XG4gICAgICBvcHRpb25zLmtleXMgPSBTdHJpbmcoYm9keS5rZXlzKTtcbiAgICB9XG4gICAgaWYgKGJvZHkuZXhjbHVkZUtleXMgIT0gbnVsbCkge1xuICAgICAgb3B0aW9ucy5leGNsdWRlS2V5cyA9IFN0cmluZyhib2R5LmV4Y2x1ZGVLZXlzKTtcbiAgICB9XG4gICAgaWYgKGJvZHkuaW5jbHVkZSAhPSBudWxsKSB7XG4gICAgICBvcHRpb25zLmluY2x1ZGUgPSBTdHJpbmcoYm9keS5pbmNsdWRlKTtcbiAgICB9XG4gICAgaWYgKGJvZHkuaW5jbHVkZUFsbCkge1xuICAgICAgb3B0aW9ucy5pbmNsdWRlQWxsID0gdHJ1ZTtcbiAgICB9XG4gICAgaWYgKHR5cGVvZiBib2R5LnJlYWRQcmVmZXJlbmNlID09PSAnc3RyaW5nJykge1xuICAgICAgb3B0aW9ucy5yZWFkUHJlZmVyZW5jZSA9IGJvZHkucmVhZFByZWZlcmVuY2U7XG4gICAgfVxuICAgIGlmICh0eXBlb2YgYm9keS5pbmNsdWRlUmVhZFByZWZlcmVuY2UgPT09ICdzdHJpbmcnKSB7XG4gICAgICBvcHRpb25zLmluY2x1ZGVSZWFkUHJlZmVyZW5jZSA9IGJvZHkuaW5jbHVkZVJlYWRQcmVmZXJlbmNlO1xuICAgIH1cbiAgICBpZiAodHlwZW9mIGJvZHkuc3VicXVlcnlSZWFkUHJlZmVyZW5jZSA9PT0gJ3N0cmluZycpIHtcbiAgICAgIG9wdGlvbnMuc3VicXVlcnlSZWFkUHJlZmVyZW5jZSA9IGJvZHkuc3VicXVlcnlSZWFkUHJlZmVyZW5jZTtcbiAgICB9XG4gICAgaWYgKGJvZHkuaGludCAmJiAodHlwZW9mIGJvZHkuaGludCA9PT0gJ3N0cmluZycgfHwgdHlwZW9mIGJvZHkuaGludCA9PT0gJ29iamVjdCcpKSB7XG4gICAgICBvcHRpb25zLmhpbnQgPSBib2R5LmhpbnQ7XG4gICAgfVxuICAgIGlmIChib2R5LmV4cGxhaW4pIHtcbiAgICAgIG9wdGlvbnMuZXhwbGFpbiA9IGJvZHkuZXhwbGFpbjtcbiAgICB9XG4gICAgcmV0dXJuIG9wdGlvbnM7XG4gIH1cblxuICBtb3VudFJvdXRlcygpIHtcbiAgICB0aGlzLnJvdXRlKCdHRVQnLCAnL2NsYXNzZXMvOmNsYXNzTmFtZScsIHJlcSA9PiB7XG4gICAgICByZXR1cm4gdGhpcy5oYW5kbGVGaW5kKHJlcSk7XG4gICAgfSk7XG4gICAgdGhpcy5yb3V0ZSgnR0VUJywgJy9jbGFzc2VzLzpjbGFzc05hbWUvOm9iamVjdElkJywgcmVxID0+IHtcbiAgICAgIHJldHVybiB0aGlzLmhhbmRsZUdldChyZXEpO1xuICAgIH0pO1xuICAgIHRoaXMucm91dGUoJ1BPU1QnLCAnL2NsYXNzZXMvOmNsYXNzTmFtZScsIHByb21pc2VFbnN1cmVJZGVtcG90ZW5jeSwgcmVxID0+IHtcbiAgICAgIHJldHVybiB0aGlzLmhhbmRsZUNyZWF0ZShyZXEpO1xuICAgIH0pO1xuICAgIHRoaXMucm91dGUoJ1BVVCcsICcvY2xhc3Nlcy86Y2xhc3NOYW1lLzpvYmplY3RJZCcsIHByb21pc2VFbnN1cmVJZGVtcG90ZW5jeSwgcmVxID0+IHtcbiAgICAgIHJldHVybiB0aGlzLmhhbmRsZVVwZGF0ZShyZXEpO1xuICAgIH0pO1xuICAgIHRoaXMucm91dGUoJ0RFTEVURScsICcvY2xhc3Nlcy86Y2xhc3NOYW1lLzpvYmplY3RJZCcsIHJlcSA9PiB7XG4gICAgICByZXR1cm4gdGhpcy5oYW5kbGVEZWxldGUocmVxKTtcbiAgICB9KTtcbiAgfVxufVxuXG5leHBvcnQgZGVmYXVsdCBDbGFzc2VzUm91dGVyO1xuIl0sIm1hcHBpbmdzIjoiOzs7Ozs7QUFBQSxJQUFBQSxjQUFBLEdBQUFDLHNCQUFBLENBQUFDLE9BQUE7QUFDQSxJQUFBQyxLQUFBLEdBQUFGLHNCQUFBLENBQUFDLE9BQUE7QUFDQSxJQUFBRSxPQUFBLEdBQUFILHNCQUFBLENBQUFDLE9BQUE7QUFDQSxJQUFBRyxLQUFBLEdBQUFKLHNCQUFBLENBQUFDLE9BQUE7QUFDQSxJQUFBSSxZQUFBLEdBQUFKLE9BQUE7QUFBMEQsU0FBQUQsdUJBQUFNLEdBQUEsV0FBQUEsR0FBQSxJQUFBQSxHQUFBLENBQUFDLFVBQUEsR0FBQUQsR0FBQSxLQUFBRSxPQUFBLEVBQUFGLEdBQUE7QUFFMUQsTUFBTUcsc0JBQXNCLEdBQUcsQ0FDN0IsTUFBTSxFQUNOLFNBQVMsRUFDVCxhQUFhLEVBQ2IsZ0JBQWdCLEVBQ2hCLHVCQUF1QixFQUN2Qix3QkFBd0Is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