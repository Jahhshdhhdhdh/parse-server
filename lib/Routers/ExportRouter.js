"use strict";

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.default = exports.ExportRouter = void 0;
var _PromiseRouter = _interopRequireDefault(require("../PromiseRouter"));
var _AdapterLoader = require("../Adapters/AdapterLoader");
var _rest = _interopRequireDefault(require("../rest"));
var _archiver = _interopRequireDefault(require("archiver"));
var _tmp = _interopRequireDefault(require("tmp"));
var _fs = _interopRequireDefault(require("fs"));
function _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }
const DefaultExportExportProgressCollectionName = '_ExportProgress';
const relationSchema = {
  fields: {
    relatedId: {
      type: 'String'
    },
    owningId: {
      type: 'String'
    }
  }
};
class ExportRouter extends _PromiseRouter.default {
  exportClassPage(req, className, jsonFileStream, where, skip, limit) {
    const databaseController = req.config.database;
    const options = {
      skip,
      limit
    };
    const findPromise = className.indexOf('_Join') === 0 ? databaseController.adapter.find(className, relationSchema, where, options) : _rest.default.find(req.config, req.auth, className, where, options);
    return findPromise.then(data => {
      if (Array.isArray(data)) {
        data = {
          results: data.map(obj => {
            // Needed to avoid errors during import.
            // See more: https://docs.parseplatform.org/js/guide/#error-codes

            // Deletes invalid keys in order to avoid "ParseError: 105 Invalid field name"
            // when importing
            Object.keys(obj).forEach(key => {
              if (key.startsWith('_')) {
                delete obj[key];
              }
            });
            return obj;
          })
        };
      }
      if (skip && data.results.length) {
        jsonFileStream.write(',\n');
      }
      jsonFileStream.write(JSON.stringify(data.results, null, 2).substr(1).slice(0, -1));
    });
  }
  exportClass(req, data) {
    const databaseController = req.config.database;
    const tmpJsonFile = _tmp.default.fileSync();
    const jsonFileStream = _fs.default.createWriteStream(tmpJsonFile.name);
    jsonFileStream.write('{\n"results" : [\n');
    const hasJoin = data.name.indexOf('_Join') === 0;
    let findPromise = null;
    if (hasJoin) {
      findPromise = databaseController.adapter.count(data.name, relationSchema, data.where);
    } else {
      findPromise = _rest.default.find(req.config, req.auth, data.name, data.where, {
        count: true,
        limit: 0
      });
    }
    return findPromise.then(result => {
      if (Number.isInteger(result)) {
        result = {
          count: result
        };
      }
      let i = 0;
      const pageLimit = 1000;
      let promise = Promise.resolve();
      for (i = 0; i < result.count; i += pageLimit) {
        const skip = i;
        promise = promise.then(() => {
          return this.exportClassPage(req, data.name, jsonFileStream, data.where, skip, pageLimit);
        });
      }
      return promise;
    }).then(() => {
      jsonFileStream.end(']\n}');
      return new Promise(resolve => {
        jsonFileStream.on('close', () => {
          tmpJsonFile._name = `${data.name.replace(/:/g, 'êž‰')}.json`;
          resolve(tmpJsonFile);
        });
      });
    });
  }
  handleExportProgress(req) {
    const databaseController = req.config.database;
    const query = {
      masterKey: req.info.masterKey,
      applicationId: req.info.appId
    };
    return databaseController.find(DefaultExportExportProgressCollectionName, query).then(response => {
      return {
        response
      };
    });
  }
  handleExport(req) {
    const databaseController = req.config.database;
    const emailControllerAdapter = (0, _AdapterLoader.loadAdapter)(req.config.emailAdapter);
    if (!emailControllerAdapter) {
      return Promise.reject(new Error('You have to setup a Mail Adapter.'));
    }
    const exportProgress = {
      id: req.body.name,
      masterKey: req.info.masterKey,
      applicationId: req.info.appId
    };
    databaseController.create(DefaultExportExportProgressCollectionName, exportProgress).then(() => {
      return databaseController.loadSchema({
        clearCache: true
      });
    }).then(schemaController => schemaController.getOneSchema(req.body.name, true)).then(schema => {
      const classNames = [req.body.name];
      Object.keys(schema.fields).forEach(fieldName => {
        const field = schema.fields[fieldName];
        if (field.type === 'Relation') {
          classNames.push(`_Join:${fieldName}:${req.body.name}`);
        }
      });
      const promisses = classNames.map(name => {
        return this.exportClass(req, {
          name
        });
      });
      return Promise.all(promisses);
    }).then(jsonFiles => {
      return new Promise(resolve => {
        const tmpZipFile = _tmp.default.fileSync();
        const tmpZipStream = _fs.default.createWriteStream(tmpZipFile.name);
        const zip = (0, _archiver.default)('zip');
        zip.pipe(tmpZipStream);
        jsonFiles.forEach(tmpJsonFile => {
          zip.append(_fs.default.readFileSync(tmpJsonFile.name), {
            name: tmpJsonFile._name
          });
          tmpJsonFile.removeCallback();
        });
        zip.finalize();
        tmpZipStream.on('close', () => {
          const buf = _fs.default.readFileSync(tmpZipFile.name);
          tmpZipFile.removeCallback();
          resolve(buf);
        });
      });
    }).then(zippedFile => {
      const filesController = req.config.filesController;
      return filesController.createFile(req.config, req.body.name, zippedFile, 'application/zip');
    }).then(fileData => {
      return emailControllerAdapter.sendMail({
        text: `We have successfully exported your data from the class ${req.body.name}.\n
        Please download from ${fileData.url}`,
        link: fileData.url,
        to: req.body.feedbackEmail,
        subject: 'Export completed'
      });
    }).catch(error => {
      return emailControllerAdapter.sendMail({
        text: `We could not export your data to the class ${req.body.name}. Error: ${error}`,
        to: req.body.feedbackEmail,
        subject: 'Export failed'
      });
    }).then(() => {
      return databaseController.destroy(DefaultExportExportProgressCollectionName, exportProgress);
    });
    return Promise.resolve({
      response: 'We are exporting your data. You will be notified by e-mail once it is completed.'
    });
  }
  mountRoutes() {
    this.route('PUT', '/export_data', req => {
      return this.handleExport(req);
    });
    this.route('GET', '/export_progress', req => {
      return this.handleExportProgress(req);
    });
  }
}
exports.ExportRouter = ExportRouter;
var _default = ExportRouter;
exports.default = _default;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJuYW1lcyI6WyJfUHJvbWlzZVJvdXRlciIsIl9pbnRlcm9wUmVxdWlyZURlZmF1bHQiLCJyZXF1aXJlIiwiX0FkYXB0ZXJMb2FkZXIiLCJfcmVzdCIsIl9hcmNoaXZlciIsIl90bXAiLCJfZnMiLCJvYmoiLCJfX2VzTW9kdWxlIiwiZGVmYXVsdCIsIkRlZmF1bHRFeHBvcnRFeHBvcnRQcm9ncmVzc0NvbGxlY3Rpb25OYW1lIiwicmVsYXRpb25TY2hlbWEiLCJmaWVsZHMiLCJyZWxhdGVkSWQiLCJ0eXBlIiwib3duaW5nSWQiLCJFeHBvcnRSb3V0ZXIiLCJQcm9taXNlUm91dGVyIiwiZXhwb3J0Q2xhc3NQYWdlIiwicmVxIiwiY2xhc3NOYW1lIiwianNvbkZpbGVTdHJlYW0iLCJ3aGVyZSIsInNraXAiLCJsaW1pdCIsImRhdGFiYXNlQ29udHJvbGxlciIsImNvbmZpZyIsImRhdGFiYXNlIiwib3B0aW9ucyIsImZpbmRQcm9taXNlIiwiaW5kZXhPZiIsImFkYXB0ZXIiLCJmaW5kIiwicmVzdCIsImF1dGgiLCJ0aGVuIiwiZGF0YSIsIkFycmF5IiwiaXNBcnJheSIsInJlc3VsdHMiLCJtYXAiLCJPYmplY3QiLCJrZXlzIiwiZm9yRWFjaCIsImtleSIsInN0YXJ0c1dpdGgiLCJsZW5ndGgiLCJ3cml0ZSIsIkpTT04iLCJzdHJpbmdpZnkiLCJzdWJzdHIiLCJzbGljZSIsImV4cG9ydENsYXNzIiwidG1wSnNvbkZpbGUiLCJ0bXAiLCJmaWxlU3luYyIsImZzIiwiY3JlYXRlV3JpdGVTdHJlYW0iLCJuYW1lIiwiaGFzSm9pbiIsImNvdW50IiwicmVzdWx0IiwiTnVtYmVyIiwiaXNJbnRlZ2VyIiwiaSIsInBhZ2VMaW1pdCIsInByb21pc2UiLCJQcm9taXNlIiwicmVzb2x2ZSIsImVuZCIsIm9uIiwiX25hbWUiLCJyZXBsYWNlIiwiaGFuZGxlRXhwb3J0UHJvZ3Jlc3MiLCJxdWVyeSIsIm1hc3RlcktleSIsImluZm8iLCJhcHBsaWNhdGlvbklkIiwiYXBwSWQiLCJyZXNwb25zZSIsImhhbmRsZUV4cG9ydCIsImVtYWlsQ29udHJvbGxlckFkYXB0ZXIiLCJsb2FkQWRhcHRlciIsImVtYWlsQWRhcHRlciIsInJlamVjdCIsIkVycm9yIiwiZXhwb3J0UHJvZ3Jlc3MiLCJpZCIsImJvZHkiLCJjcmVhdGUiLCJsb2FkU2NoZW1hIiwiY2xlYXJDYWNoZSIsInNjaGVtYUNvbnRyb2xsZXIiLCJnZXRPbmVTY2hlbWEiLCJzY2hlbWEiLCJjbGFzc05hbWVzIiwiZmllbGROYW1lIiwiZmllbGQiLCJwdXNoIiwicHJvbWlzc2VzIiwiYWxsIiwianNvbkZpbGVzIiwidG1wWmlwRmlsZSIsInRtcFppcFN0cmVhbSIsInppcCIsImFyY2hpdmVyIiwicGlwZSIsImFwcGVuZCIsInJlYWRGaWxlU3luYyIsInJlbW92ZUNhbGxiYWNrIiwiZmluYWxpemUiLCJidWYiLCJ6aXBwZWRGaWxlIiwiZmlsZXNDb250cm9sbGVyIiwiY3JlYXRlRmlsZSIsImZpbGVEYXRhIiwic2VuZE1haWwiLCJ0ZXh0IiwidXJsIiwibGluayIsInRvIiwiZmVlZGJhY2tFbWFpbCIsInN1YmplY3QiLCJjYXRjaCIsImVycm9yIiwiZGVzdHJveSIsIm1vdW50Um91dGVzIiwicm91dGUiLCJleHBvcnRzIiwiX2RlZmF1bHQiXSwic291cmNlcyI6WyIuLi8uLi9zcmMvUm91dGVycy9FeHBvcnRSb3V0ZXIuanMiXSwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IFByb21pc2VSb3V0ZXIgZnJvbSAnLi4vUHJvbWlzZVJvdXRlcic7XG5pbXBvcnQgeyBsb2FkQWRhcHRlciB9IGZyb20gJy4uL0FkYXB0ZXJzL0FkYXB0ZXJMb2FkZXInO1xuaW1wb3J0IHJlc3QgZnJvbSAnLi4vcmVzdCc7XG5pbXBvcnQgYXJjaGl2ZXIgZnJvbSAnYXJjaGl2ZXInO1xuaW1wb3J0IHRtcCBmcm9tICd0bXAnO1xuaW1wb3J0IGZzIGZyb20gJ2ZzJztcblxuY29uc3QgRGVmYXVsdEV4cG9ydEV4cG9ydFByb2dyZXNzQ29sbGVjdGlvbk5hbWUgPSAnX0V4cG9ydFByb2dyZXNzJztcbmNvbnN0IHJlbGF0aW9uU2NoZW1hID0ge1xuICBmaWVsZHM6IHsgcmVsYXRlZElkOiB7IHR5cGU6ICdTdHJpbmcnIH0sIG93bmluZ0lkOiB7IHR5cGU6ICdTdHJpbmcnIH0gfSxcbn07XG5cbmV4cG9ydCBjbGFzcyBFeHBvcnRSb3V0ZXIgZXh0ZW5kcyBQcm9taXNlUm91dGVyIHtcbiAgZXhwb3J0Q2xhc3NQYWdlKHJlcSwgY2xhc3NOYW1lLCBqc29uRmlsZVN0cmVhbSwgd2hlcmUsIHNraXAsIGxpbWl0KSB7XG4gICAgY29uc3QgZGF0YWJhc2VDb250cm9sbGVyID0gcmVxLmNvbmZpZy5kYXRhYmFzZTtcblxuICAgIGNvbnN0IG9wdGlvbnMgPSB7XG4gICAgICBza2lwLFxuICAgICAgbGltaXQsXG4gICAgfTtcblxuICAgIGNvbnN0IGZpbmRQcm9taXNlID1cbiAgICAgIGNsYXNzTmFtZS5pbmRleE9mKCdfSm9pbicpID09PSAwXG4gICAgICAgID8gZGF0YWJhc2VDb250cm9sbGVyLmFkYXB0ZXIuZmluZChcbiAgICAgICAgICBjbGFzc05hbWUsXG4gICAgICAgICAgcmVsYXRpb25TY2hlbWEsXG4gICAgICAgICAgd2hlcmUsXG4gICAgICAgICAgb3B0aW9uc1xuICAgICAgICApXG4gICAgICAgIDogcmVzdC5maW5kKHJlcS5jb25maWcsIHJlcS5hdXRoLCBjbGFzc05hbWUsIHdoZXJlLCBvcHRpb25zKTtcblxuICAgIHJldHVybiBmaW5kUHJvbWlzZS50aGVuKGRhdGEgPT4ge1xuICAgICAgaWYgKEFycmF5LmlzQXJyYXkoZGF0YSkpIHtcbiAgICAgICAgZGF0YSA9IHtcbiAgICAgICAgICByZXN1bHRzOiBkYXRhLm1hcChvYmogPT4ge1xuICAgICAgICAgICAgLy8gTmVlZGVkIHRvIGF2b2lkIGVycm9ycyBkdXJpbmcgaW1wb3J0LlxuICAgICAgICAgICAgLy8gU2VlIG1vcmU6IGh0dHBzOi8vZG9jcy5wYXJzZXBsYXRmb3JtLm9yZy9qcy9ndWlkZS8jZXJyb3ItY29kZXNcblxuICAgICAgICAgICAgLy8gRGVsZXRlcyBpbnZhbGlkIGtleXMgaW4gb3JkZXIgdG8gYXZvaWQgXCJQYXJzZUVycm9yOiAxMDUgSW52YWxpZCBmaWVsZCBuYW1lXCJcbiAgICAgICAgICAgIC8vIHdoZW4gaW1wb3J0aW5nXG4gICAgICAgICAgICBPYmplY3Qua2V5cyhvYmopLmZvckVhY2goa2V5ID0+IHtcbiAgICAgICAgICAgICAgaWYgKGtleS5zdGFydHNXaXRoKCdfJykpIHtcbiAgICAgICAgICAgICAgICBkZWxldGUgb2JqW2tleV07XG4gICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgcmV0dXJuIG9iajtcbiAgICAgICAgICB9KSxcbiAgICAgICAgfTtcbiAgICAgIH1cblxuICAgICAgaWYgKHNraXAgJiYgZGF0YS5yZXN1bHRzLmxlbmd0aCkge1xuICAgICAgICBqc29uRmlsZVN0cmVhbS53cml0ZSgnLFxcbicpO1xuICAgICAgfVxuXG4gICAgICBqc29uRmlsZVN0cmVhbS53cml0ZShcbiAgICAgICAgSlNPTi5zdHJpbmdpZnkoZGF0YS5yZXN1bHRzLCBudWxsLCAyKVxuICAgICAgICAgIC5zdWJzdHIoMSlcbiAgICAgICAgICAuc2xpY2UoMCwgLTEpXG4gICAgICApO1xuICAgIH0pO1xuICB9XG5cbiAgZXhwb3J0Q2xhc3MocmVxLCBkYXRhKSB7XG4gICAgY29uc3QgZGF0YWJhc2VDb250cm9sbGVyID0gcmVxLmNvbmZpZy5kYXRhYmFzZTtcbiAgICBjb25zdCB0bXBKc29uRmlsZSA9IHRtcC5maWxlU3luYygpO1xuICAgIGNvbnN0IGpzb25GaWxlU3RyZWFtID0gZnMuY3JlYXRlV3JpdGVTdHJlYW0odG1wSnNvbkZpbGUubmFtZSk7XG5cbiAgICBqc29uRmlsZVN0cmVhbS53cml0ZSgne1xcblwicmVzdWx0c1wiIDogW1xcbicpO1xuICAgIGNvbnN0IGhhc0pvaW4gPSBkYXRhLm5hbWUuaW5kZXhPZignX0pvaW4nKSA9PT0gMDtcbiAgICBsZXQgZmluZFByb21pc2UgPSBudWxsO1xuICAgIGlmIChoYXNKb2luKSB7XG4gICAgICBmaW5kUHJvbWlzZSA9IGRhdGFiYXNlQ29udHJvbGxlci5hZGFwdGVyLmNvdW50KFxuICAgICAgICBkYXRhLm5hbWUsXG4gICAgICAgIHJlbGF0aW9uU2NoZW1hLFxuICAgICAgICBkYXRhLndoZXJlXG4gICAgICApO1xuICAgIH0gZWxzZSB7XG4gICAgICBmaW5kUHJvbWlzZSA9IHJlc3QuZmluZChyZXEuY29uZmlnLCByZXEuYXV0aCwgZGF0YS5uYW1lLCBkYXRhLndoZXJlLCB7XG4gICAgICAgIGNvdW50OiB0cnVlLFxuICAgICAgICBsaW1pdDogMCxcbiAgICAgIH0pO1xuICAgIH1cblxuICAgIHJldHVybiBmaW5kUHJvbWlzZVxuICAgICAgLnRoZW4ocmVzdWx0ID0+IHtcbiAgICAgICAgaWYgKE51bWJlci5pc0ludGVnZXIocmVzdWx0KSkge1xuICAgICAgICAgIHJlc3VsdCA9IHsgY291bnQ6IHJlc3VsdCB9O1xuICAgICAgICB9XG5cbiAgICAgICAgbGV0IGkgPSAwO1xuICAgICAgICBjb25zdCBwYWdlTGltaXQgPSAxMDAwO1xuICAgICAgICBsZXQgcHJvbWlzZSA9IFByb21pc2UucmVzb2x2ZSgpO1xuXG4gICAgICAgIGZvciAoaSA9IDA7IGkgPCByZXN1bHQuY291bnQ7IGkgKz0gcGFnZUxpbWl0KSB7XG4gICAgICAgICAgY29uc3Qgc2tpcCA9IGk7XG4gICAgICAgICAgcHJvbWlzZSA9IHByb21pc2UudGhlbigoKSA9PiB7XG4gICAgICAgICAgICByZXR1cm4gdGhpcy5leHBvcnRDbGFzc1BhZ2UoXG4gICAgICAgICAgICAgIHJlcSxcbiAgICAgICAgICAgICAgZGF0YS5uYW1lLFxuICAgICAgICAgICAgICBqc29uRmlsZVN0cmVhbSxcbiAgICAgICAgICAgICAgZGF0YS53aGVyZSxcbiAgICAgICAgICAgICAgc2tpcCxcbiAgICAgICAgICAgICAgcGFnZUxpbWl0XG4gICAgICAgICAgICApO1xuICAgICAgICAgIH0pO1xuICAgICAgICB9XG5cbiAgICAgICAgcmV0dXJuIHByb21pc2U7XG4gICAgICB9KVxuICAgICAgLnRoZW4oKCkgPT4ge1xuICAgICAgICBqc29uRmlsZVN0cmVhbS5lbmQoJ11cXG59Jyk7XG5cbiAgICAgICAgcmV0dXJuIG5ldyBQcm9taXNlKHJlc29sdmUgPT4ge1xuICAgICAgICAgIGpzb25GaWxlU3RyZWFtLm9uKCdjbG9zZScsICgpID0+IHtcbiAgICAgICAgICAgIHRtcEpzb25GaWxlLl9uYW1lID0gYCR7ZGF0YS5uYW1lLnJlcGxhY2UoLzovZywgJ+qeiScpfS5qc29uYDtcblxuICAgICAgICAgICAgcmVzb2x2ZSh0bXBKc29uRmlsZSk7XG4gICAgICAgICAgfSk7XG4gICAgICAgIH0pO1xuICAgICAgfSk7XG4gIH1cblxuICBoYW5kbGVFeHBvcnRQcm9ncmVzcyhyZXEpIHtcbiAgICBjb25zdCBkYXRhYmFzZUNvbnRyb2xsZXIgPSByZXEuY29uZmlnLmRhdGFiYXNlO1xuXG4gICAgY29uc3QgcXVlcnkgPSB7XG4gICAgICBtYXN0ZXJLZXk6IHJlcS5pbmZvLm1hc3RlcktleSxcbiAgICAgIGFwcGxpY2F0aW9uSWQ6IHJlcS5pbmZvLmFwcElkLFxuICAgIH07XG5cbiAgICByZXR1cm4gZGF0YWJhc2VDb250cm9sbGVyXG4gICAgICAuZmluZChEZWZhdWx0RXhwb3J0RXhwb3J0UHJvZ3Jlc3NDb2xsZWN0aW9uTmFtZSwgcXVlcnkpXG4gICAgICAudGhlbihyZXNwb25zZSA9PiB7XG4gICAgICAgIHJldHVybiB7IHJlc3BvbnNlIH07XG4gICAgICB9KTtcbiAgfVxuXG4gIGhhbmRsZUV4cG9ydChyZXEpIHtcbiAgICBjb25zdCBkYXRhYmFzZUNvbnRyb2xsZXIgPSByZXEuY29uZmlnLmRhdGFiYXNlO1xuXG4gICAgY29uc3QgZW1haWxDb250cm9sbGVyQWRhcHRlciA9IGxvYWRBZGFwdGVyKHJlcS5jb25maWcuZW1haWxBZGFwdGVyKTtcblxuICAgIGlmICghZW1haWxDb250cm9sbGVyQWRhcHRlcikge1xuICAgICAgcmV0dXJuIFByb21pc2UucmVqZWN0KG5ldyBFcnJvcignWW91IGhhdmUgdG8gc2V0dXAgYSBNYWlsIEFkYXB0ZXIuJykpO1xuICAgIH1cblxuICAgIGNvbnN0IGV4cG9ydFByb2dyZXNzID0ge1xuICAgICAgaWQ6IHJlcS5ib2R5Lm5hbWUsXG4gICAgICBtYXN0ZXJLZXk6IHJlcS5pbmZvLm1hc3RlcktleSxcbiAgICAgIGFwcGxpY2F0aW9uSWQ6IHJlcS5pbmZvLmFwcElkLFxuICAgIH07XG5cbiAgICBkYXRhYmFzZUNvbnRyb2xsZXJcbiAgICAgIC5jcmVhdGUoRGVmYXVsdEV4cG9ydEV4cG9ydFByb2dyZXNzQ29sbGVjdGlvbk5hbWUsIGV4cG9ydFByb2dyZXNzKVxuICAgICAgLnRoZW4oKCkgPT4ge1xuICAgICAgICByZXR1cm4gZGF0YWJhc2VDb250cm9sbGVyLmxvYWRTY2hlbWEoeyBjbGVhckNhY2hlOiB0cnVlIH0pO1xuICAgICAgfSlcbiAgICAgIC50aGVuKHNjaGVtYUNvbnRyb2xsZXIgPT5cbiAgICAgICAgc2NoZW1hQ29udHJvbGxlci5nZXRPbmVTY2hlbWEocmVxLmJvZHkubmFtZSwgdHJ1ZSlcbiAgICAgIClcbiAgICAgIC50aGVuKHNjaGVtYSA9PiB7XG4gICAgICAgIGNvbnN0IGNsYXNzTmFtZXMgPSBbcmVxLmJvZHkubmFtZV07XG4gICAgICAgIE9iamVjdC5rZXlzKHNjaGVtYS5maWVsZHMpLmZvckVhY2goZmllbGROYW1lID0+IHtcbiAgICAgICAgICBjb25zdCBmaWVsZCA9IHNjaGVtYS5maWVsZHNbZmllbGROYW1lXTtcblxuICAgICAgICAgIGlmIChmaWVsZC50eXBlID09PSAnUmVsYXRpb24nKSB7XG4gICAgICAgICAgICBjbGFzc05hbWVzLnB1c2goYF9Kb2luOiR7ZmllbGROYW1lfToke3JlcS5ib2R5Lm5hbWV9YCk7XG4gICAgICAgICAgfVxuICAgICAgICB9KTtcblxuICAgICAgICBjb25zdCBwcm9taXNzZXMgPSBjbGFzc05hbWVzLm1hcChuYW1lID0+IHtcbiAgICAgICAgICByZXR1cm4gdGhpcy5leHBvcnRDbGFzcyhyZXEsIHsgbmFtZSB9KTtcbiAgICAgICAgfSk7XG5cbiAgICAgICAgcmV0dXJuIFByb21pc2UuYWxsKHByb21pc3Nlcyk7XG4gICAgICB9KVxuICAgICAgLnRoZW4oanNvbkZpbGVzID0+IHtcbiAgICAgICAgcmV0dXJuIG5ldyBQcm9taXNlKHJlc29sdmUgPT4ge1xuICAgICAgICAgIGNvbnN0IHRtcFppcEZpbGUgPSB0bXAuZmlsZVN5bmMoKTtcbiAgICAgICAgICBjb25zdCB0bXBaaXBTdHJlYW0gPSBmcy5jcmVhdGVXcml0ZVN0cmVhbSh0bXBaaXBGaWxlLm5hbWUpO1xuXG4gICAgICAgICAgY29uc3QgemlwID0gYXJjaGl2ZXIoJ3ppcCcpO1xuICAgICAgICAgIHppcC5waXBlKHRtcFppcFN0cmVhbSk7XG5cbiAgICAgICAgICBqc29uRmlsZXMuZm9yRWFjaCh0bXBKc29uRmlsZSA9PiB7XG4gICAgICAgICAgICB6aXAuYXBwZW5kKGZzLnJlYWRGaWxlU3luYyh0bXBKc29uRmlsZS5uYW1lKSwge1xuICAgICAgICAgICAgICBuYW1lOiB0bXBKc29uRmlsZS5fbmFtZSxcbiAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgdG1wSnNvbkZpbGUucmVtb3ZlQ2FsbGJhY2soKTtcbiAgICAgICAgICB9KTtcblxuICAgICAgICAgIHppcC5maW5hbGl6ZSgpO1xuXG4gICAgICAgICAgdG1wWmlwU3RyZWFtLm9uKCdjbG9zZScsICgpID0+IHtcbiAgICAgICAgICAgIGNvbnN0IGJ1ZiA9IGZzLnJlYWRGaWxlU3luYyh0bXBaaXBGaWxlLm5hbWUpO1xuICAgICAgICAgICAgdG1wWmlwRmlsZS5yZW1vdmVDYWxsYmFjaygpO1xuICAgICAgICAgICAgcmVzb2x2ZShidWYpO1xuICAgICAgICAgIH0pO1xuICAgICAgICB9KTtcbiAgICAgIH0pXG4gICAgICAudGhlbih6aXBwZWRGaWxlID0+IHtcbiAgICAgICAgY29uc3QgZmlsZXNDb250cm9sbGVyID0gcmVxLmNvbmZpZy5maWxlc0NvbnRyb2xsZXI7XG4gICAgICAgIHJldHVybiBmaWxlc0NvbnRyb2xsZXIuY3JlYXRlRmlsZShcbiAgICAgICAgICByZXEuY29uZmlnLFxuICAgICAgICAgIHJlcS5ib2R5Lm5hbWUsXG4gICAgICAgICAgemlwcGVkRmlsZSxcbiAgICAgICAgICAnYXBwbGljYXRpb24vemlwJ1xuICAgICAgICApO1xuICAgICAgfSlcbiAgICAgIC50aGVuKGZpbGVEYXRhID0+IHtcbiAgICAgICAgcmV0dXJuIGVtYWlsQ29udHJvbGxlckFkYXB0ZXIuc2VuZE1haWwoe1xuICAgICAgICAgIHRleHQ6IGBXZSBoYXZlIHN1Y2Nlc3NmdWxseSBleHBvcnRlZCB5b3VyIGRhdGEgZnJvbSB0aGUgY2xhc3MgJHtyZXEuYm9keS5uYW1lfS5cXG5cbiAgICAgICAgUGxlYXNlIGRvd25sb2FkIGZyb20gJHtmaWxlRGF0YS51cmx9YCxcbiAgICAgICAgICBsaW5rOiBmaWxlRGF0YS51cmwsXG4gICAgICAgICAgdG86IHJlcS5ib2R5LmZlZWRiYWNrRW1haWwsXG4gICAgICAgICAgc3ViamVjdDogJ0V4cG9ydCBjb21wbGV0ZWQnLFxuICAgICAgICB9KTtcbiAgICAgIH0pXG4gICAgICAuY2F0Y2goZXJyb3IgPT4ge1xuICAgICAgICByZXR1cm4gZW1haWxDb250cm9sbGVyQWRhcHRlci5zZW5kTWFpbCh7XG4gICAgICAgICAgdGV4dDogYFdlIGNvdWxkIG5vdCBleHBvcnQgeW91ciBkYXRhIHRvIHRoZSBjbGFzcyAke3JlcS5ib2R5Lm5hbWV9LiBFcnJvcjogJHtlcnJvcn1gLFxuICAgICAgICAgIHRvOiByZXEuYm9keS5mZWVkYmFja0VtYWlsLFxuICAgICAgICAgIHN1YmplY3Q6ICdFeHBvcnQgZmFpbGVkJyxcbiAgICAgICAgfSk7XG4gICAgICB9KVxuICAgICAgLnRoZW4oKCkgPT4ge1xuICAgICAgICByZXR1cm4gZGF0YWJhc2VDb250cm9sbGVyLmRlc3Ryb3koXG4gICAgICAgICAgRGVmYXVsdEV4cG9ydEV4cG9ydFByb2dyZXNzQ29sbGVjdGlvbk5hbWUsXG4gICAgICAgICAgZXhwb3J0UHJvZ3Jlc3NcbiAgICAgICAgKTtcbiAgICAgIH0pO1xuXG4gICAgcmV0dXJuIFByb21pc2UucmVzb2x2ZSh7XG4gICAgICByZXNwb25zZTpcbiAgICAgICAgJ1dlIGFyZSBleHBvcnRpbmcgeW91ciBkYXRhLiBZb3Ugd2lsbCBiZSBub3RpZmllZCBieSBlLW1haWwgb25jZSBpdCBpcyBjb21wbGV0ZWQuJyxcbiAgICB9KTtcbiAgfVxuXG4gIG1vdW50Um91dGVzKCkge1xuICAgIHRoaXMucm91dGUoJ1BVVCcsICcvZXhwb3J0X2RhdGEnLCByZXEgPT4ge1xuICAgICAgcmV0dXJuIHRoaXMuaGFuZGxlRXhwb3J0KHJlcSk7XG4gICAgfSk7XG5cbiAgICB0aGlzLnJvdXRlKCdHRVQnLCAnL2V4cG9ydF9wcm9ncmVzcycsIHJlcSA9PiB7XG4gICAgICByZXR1cm4gdGhpcy5oYW5kbGVFeHBvcnRQcm9ncmVzcyhyZXEpO1xuICAgIH0pO1xuICB9XG59XG5cbmV4cG9ydCBkZWZhdWx0IEV4cG9ydFJvdXRlcjtcbiJdLCJtYXBwaW5ncyI6Ijs7Ozs7O0FBQUEsSUFBQUEsY0FBQSxHQUFBQyxzQkFBQSxDQUFBQyxPQUFBO0FBQ0EsSUFBQUMsY0FBQSxHQUFBRCxPQUFBO0FBQ0EsSUFBQUUsS0FBQSxHQUFBSCxzQkFBQSxDQUFBQyxPQUFBO0FBQ0EsSUFBQUcsU0FBQSxHQUFBSixzQkFBQSxDQUFBQyxPQUFBO0FBQ0EsSUFBQUksSUFBQSxHQUFBTCxzQkFBQSxDQUFBQyxPQUFBO0FBQ0EsSUFBQUssR0FBQSxHQUFBTixzQkFBQSxDQUFBQyxPQUFBO0FBQW9CLFNBQUFELHVCQUFBTyxHQUFBLFdBQUFBLEdBQUEsSUFBQUEsR0FBQSxDQUFBQyxVQUFBLEdBQUFELEdBQUEsS0FBQUUsT0FBQSxFQUFBRixHQUFBO0FBRXBCLE1BQU1HLHlDQUF5QyxHQUFHLGlCQUFpQjtBQUNuRSxN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